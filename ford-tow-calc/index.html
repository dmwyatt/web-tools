<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ford F-150 Towing Calculator</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    body {
      background-color: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 30px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: #0052cc;
      margin-bottom: 24px;
      font-size: 24px;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    
    .hint {
      display: block;
      margin-top: 6px;
      font-size: 14px;
      color: #666;
    }
    
    button {
      background-color: #0052cc;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #003d99;
    }
    
    button:disabled {
      background-color: #99bbee;
      cursor: not-allowed;
    }
    
    .error {
      margin: 20px 0;
      padding: 15px;
      border-left: 4px solid #d32f2f;
      background-color: #ffebee;
      color: #d32f2f;
    }
    
    .results {
      margin-top: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }
    
    .results h2 {
      margin-bottom: 20px;
      font-size: 20px;
    }
    
    .results-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    @media (min-width: 768px) {
      .results-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    h3 {
      margin-bottom: 12px;
      font-size: 18px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    tr {
      border-bottom: 1px solid #e9ecef;
    }
    
    td {
      padding: 10px 0;
      vertical-align: top;
    }
    
    td:first-child {
      color: #555;
      padding-right: 10px;
    }
    
    td:last-child {
      font-weight: 500;
    }
    
    .tow-rating {
      margin-top: 24px;
      padding: 16px;
      background-color: #e3f2fd;
      border-left: 4px solid #1976d2;
    }
    
    .tow-rating h3 {
      color: #0d47a1;
      margin-bottom: 8px;
    }
    
    .note {
      margin-top: 32px;
      font-size: 14px;
      color: #666;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ford F-150 Towing Calculator</h1>
    
    <div class="input-group">
      <label for="vin">VIN (17 characters):</label>
      <input 
        type="text" 
        id="vin" 
        placeholder="Enter 17-character VIN"
        maxlength="17"
      >
    </div>
    
    <div class="input-group">
      <label for="occupant-weight">Occupant & Cargo Weight (lbs):</label>
      <input 
        type="number" 
        id="occupant-weight" 
        value="700"
        min="0"
      >
      <span class="hint">Default is 700 lbs (approx. 4 passengers + cargo)</span>
    </div>
    
    <button id="calculate-btn">Calculate Tow Rating</button>
    
    <div id="error-container" class="error" style="display: none;"></div>
    
    <div id="results-container" class="results" style="display: none;">
      <h2 id="vehicle-title">Results</h2>
      
      <div class="results-grid">
        <div>
          <h3>Vehicle Specifications</h3>
          <table>
            <tbody>
              <tr>
                <td>VIN:</td>
                <td id="result-vin"></td>
              </tr>
              <tr>
                <td>Maximum Payload:</td>
                <td id="result-max-payload"></td>
              </tr>
              <tr>
                <td>Maximum Conventional Towing:</td>
                <td id="result-max-towing"></td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div>
          <h3>Towing Calculation</h3>
          <table>
            <tbody>
              <tr>
                <td>Occupant & Cargo Weight:</td>
                <td id="result-occupant-weight"></td>
              </tr>
              <tr>
                <td>Available Payload:</td>
                <td id="result-available-payload"></td>
              </tr>
              <tr>
                <td>Payload-Based Towing <span style="font-size: 12px;">(10% tongue weight)</span>:</td>
                <td id="result-payload-based-towing"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="tow-rating">
        <h3>Safe Tow Rating: <span id="result-safe-tow-rating"></span></h3>
        <p>This is the lower of the maximum conventional towing capacity and the payload-based towing capacity.</p>
      </div>
    </div>
    
    <p class="note">Note: This application connects directly to the Ford API to fetch real data for F-150 vehicles. Enter a valid F-150 VIN to get accurate towing calculations.</p>
  </div>

  <script>
    // DOM Elements
    const vinInput = document.getElementById('vin');
    const occupantWeightInput = document.getElementById('occupant-weight');
    const calculateBtn = document.getElementById('calculate-btn');
    const errorContainer = document.getElementById('error-container');
    const resultsContainer = document.getElementById('results-container');
    
    // Format number with commas
    function formatNumber(num) {
      return Math.round(num).toLocaleString();
    }
    
    // API Call Function
    async function getF150TowRating(vin, occupantWeight) {
      // Ford API endpoint
      const API_ENDPOINT = "https://api.pd01e.gcp.ford.com/digitalservices/fs/api/v3/vehicles/vehicle-type";
      const CONSUMER_KEY = "Z28tbmEtZm9yZA=="; // Base64 encoded key
      
      try {
        // Call the Ford API
        const response = await fetch(`${API_ENDPOINT}?locale=en-us&country=USA`, {
          headers: {
            "Accept": "application/json",
            "Consumer-Key": CONSUMER_KEY,
            "Origin": "https://www.ford.com",
            "Referer": "https://www.ford.com/",
            "vin": vin
          }
        });
        
        if (!response.ok) {
          throw new Error(`Ford API error: ${response.status}`);
        }
        
        // Parse the response
        const data = await response.json();
        const vehicleData = data.vehicleData;
        
        // Get the payload and max tow values
        const maxPayload = parseInt(vehicleData.maximumPayloadPounds, 10);
        const maxTow = parseInt(vehicleData.maximumConventionalPounds, 10);
        
        // Calculate with custom occupant + cargo weight
        const availablePayload = maxPayload - occupantWeight;
        const payloadBasedTowing = availablePayload / 0.1; // 10% tongue weight
        
        // Get the safe tow rating (lower of payload-based or manufacturer max)
        const safeTowRating = Math.min(maxTow, payloadBasedTowing);
        
        return {
          vin: vehicleData.vin,
          model: vehicleData.model,
          year: vehicleData.year,
          maxPayloadPounds: maxPayload,
          maxConventionalTowing: maxTow,
          occupantAndCargoWeight: occupantWeight,
          availablePayload: availablePayload,
          payloadBasedTowing: payloadBasedTowing,
          calculatedTowRating: safeTowRating,
          rawResponse: data // Include full API response for reference
        };
        
      } catch (error) {
        console.error(`Failed to get tow rating for VIN ${vin}:`, error);
        throw error;
      }
    }
    
    // Display Results Function
    function displayResults(results) {
      // Set all the result fields
      document.getElementById('vehicle-title').textContent = `Results for ${results.year} ${results.model}`;
      document.getElementById('result-vin').textContent = results.vin;
      document.getElementById('result-max-payload').textContent = `${formatNumber(results.maxPayloadPounds)} lbs`;
      document.getElementById('result-max-towing').textContent = `${formatNumber(results.maxConventionalTowing)} lbs`;
      document.getElementById('result-occupant-weight').textContent = `${formatNumber(results.occupantAndCargoWeight)} lbs`;
      document.getElementById('result-available-payload').textContent = `${formatNumber(results.availablePayload)} lbs`;
      document.getElementById('result-payload-based-towing').textContent = `${formatNumber(results.payloadBasedTowing)} lbs`;
      document.getElementById('result-safe-tow-rating').textContent = `${formatNumber(results.calculatedTowRating)} lbs`;
      
      // Show the results container
      resultsContainer.style.display = 'block';
    }
    
    // Event Listeners
    calculateBtn.addEventListener('click', async function() {
      // Show loading state
      calculateBtn.disabled = true;
      calculateBtn.innerHTML = '<span class="loading"></span> Calculating...';
      errorContainer.style.display = 'none';
      resultsContainer.style.display = 'none';
      
      try {
        const vin = vinInput.value.trim();
        const occupantWeight = parseInt(occupantWeightInput.value, 10) || 700;
        
        // Validate VIN
        if (!vin || vin.length !== 17) {
          throw new Error('Please enter a valid 17-character VIN');
        }
        
        // Call API and get results
        const results = await getF150TowRating(vin, occupantWeight);
        
        // Display results
        displayResults(results);
        
      } catch (error) {
        // Show error
        errorContainer.textContent = error.message || 'An error occurred while fetching vehicle data';
        errorContainer.style.display = 'block';
      } finally {
        // Reset button state
        calculateBtn.disabled = false;
        calculateBtn.textContent = 'Calculate Tow Rating';
      }
    });
  </script>
</body>
</html>